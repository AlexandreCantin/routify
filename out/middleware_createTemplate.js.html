<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: middleware/createTemplate.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: middleware/createTemplate.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// const { serializeRoute } = require('../utils')
const path = require('path')
const { name, version } = require('../../package.json')

module.exports = function template(payload) {
  const { tree, options } = payload
  const { dynamicImports } = options

  const buildRoutes_js = path.resolve(__dirname, '../../runtime/buildRoutes').replace(/\\/g, '/')

  function importTemplate() {
    // const imports = routes.filter(route => !dynamicImports || route.meta.preload)
    return getImports(tree.dir).map(
      route => `import ${route.id} from '${route.absolutePath}'`
    ).join(`\n`)
  }

  function getImports(dir, imports = []) {
    dir.forEach(file => {
      if (file.dir)
        getImports(file.dir, imports, false)
      if (file.isFile &amp;&amp; (file.meta.preload || !dynamicImports))
        imports.push(file)
    })
    return imports
  }

  function escapeStuff(str) {
    return str.replace(/"'''|'''"/g, '')
  }

  /**
   * TEMPLATE
   */
  payload.template = `
/**
 * ${name} ${version}
 * File generated ${new Date}
 */

export const __version = "${version}"
export const __timestamp = "${(new Date).toISOString()}"

//buildRoutes
import { buildRoutes, buildClientTree } from "${buildRoutes_js}"

//imports
${importTemplate()}

//options
export const options = ${JSON.stringify({})}

//tree
export const _tree = ${escapeStuff(JSON.stringify({ ...tree, dir: stripKeys(tree.dir) }, 0, 2))}

export const tree = buildClientTree(_tree)

//routes
export const routes = buildRoutes(tree.children)
`
}

function stripKeys(tree) {
  const keys = ['file', 'filepath', 'name', 'badExt', 'relativeDir', 'absolutePath']
  return tree.map(file => {
    const newObj = {}
    Object.keys(file).forEach(key => {
      if (!keys.includes(key))
        newObj[key] = file[key]
    })
    if (file.dir)
      newObj.dir = stripKeys(file.dir)
    return newObj
  })
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_dump">_dump</a></li><li><a href="global.html#_log">_log</a></li><li><a href="global.html#applyMetaToTree">applyMetaToTree</a></li><li><a href="global.html#clone">clone</a></li><li><a href="global.html#createNodeMiddleware">createNodeMiddleware</a></li><li><a href="global.html#defineDefaultMeta">defineDefaultMeta</a></li><li><a href="global.html#flattenTree">flattenTree</a></li><li><a href="global.html#fsa">fsa</a></li><li><a href="global.html#generateFileTree">generateFileTree</a></li><li><a href="global.html#mergeMeta">mergeMeta</a></li><li><a href="global.html#nodeMiddleware">nodeMiddleware</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Apr 07 2020 18:23:25 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
